#include <stdio.h>
#include <archive.h>
#include <archive_entry.h>

int extract_rar(const char* rar_file, const char* extract_dir) {
  struct archive* rar;
  struct archive_entry* entry;
  int result;

  rar = archive_read_new();
  archive_read_support_filter_all(rar);
  archive_read_support_format_rar(rar);

  if ((result = archive_read_open_filename(rar, rar_file, 10240))) {
    return result;
  }

  while ((result = archive_read_next_header(rar, &entry)) == ARCHIVE_OK) {
    const char* entry_pathname = archive_entry_pathname(entry);
    char extract_pathname[1024];
    snprintf(extract_pathname, sizeof(extract_pathname), "%s/%s", extract_dir, entry_pathname);

    archive_entry_set_pathname(entry, extract_pathname);
    archive_read_extract(rar, entry, ARCHIVE_EXTRACT_TIME);
  }

  archive_read_close(rar);
  archive_read_free(rar);

  return 0;
}

int main() {
  extract_rar("archivo.rar", "directorio_destino");
  return 0;
}
